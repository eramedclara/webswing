(function(e){e([],function(){function t(e,t,n,r,i,s,o){function a(){return r.getSessions(u.path).then(function(e){t.cancel(u.timer),u.sessions=e.sessions||[],u.closedSessions=e.closedSessions||[],u.recordings=e.recordings||[],u.sessionLoggingEnabled=e.sessionLoggingEnabled,u.lastUpdated=new Date}).then(function(){return u.timer=t(a,2e3),u.timer},function(){t.cancel(u.timer),u.timer=undefined})}function f(e){u.sortExp===e?u.sortReverse=!u.sortReverse:(u.sortExp=e,u.sortReverse=!1)}function l(e){var t="metrics.memoryUsed";e!=null&&(t="metrics['memoryUsed."+e+"']"),f(t)}function c(e){var t="metrics.latency";e!=null&&(t="metrics['latency."+e+"']"),f(t)}function h(e){var t="metrics.inboundSize + metrics.outboundSize";e!=null&&(t="metrics['inboundSize."+e+"'] + metrics['outboundSize."+e+"']"),f(t)}function p(e){u.sortFinishedExp===e?u.sortFinishedReverse=!u.sortFinishedReverse:(u.sortFinishedExp=e,u.sortFinishedReverse=!1)}function d(e){if(e!=null)return e==="Windows"?"wsa-icon-windows":e==="Mac"||e==="IPhone"?"wsa-icon-apple":e==="Linux"?"wsa-icon-linux":e==="Android"?"wsa-icon-android":"wsa-icon-unknown"}function v(e){if(e!=null)return e.indexOf("IE")>=0?"wsa-icon-ie":e.indexOf("Safari")>=0?"wsa-icon-safari":e.indexOf("Opera")>=0?"wsa-icon-opera":e.indexOf("Chrome")>=0?"wsa-icon-chrome":e.indexOf("Firefox")>=0?"wsa-icon-firefox":"wsa-icon-unknown"}function m(e){return e.split(/\n(?=\d{4})/g)}function g(e){return r.killSession(u.path,e.id).then(function(){a()})}function y(e){n.search("id",e.id),n.path("/dashboard/session/"+u.path)}function b(e){w(),u.logSession=e,u.log=[],S(102400,-1,!0).then(function(){E()})}function w(){u.logTimer&&t.cancel(u.logTimer),u.log=[]}function E(){return S(102400,u.logEndOffset,!1).then(function(e){t.cancel(u.logTimer)}).then(function(){return u.logTimer&&t.cancel(u.logTimer),u.logTimer=t(E,1e3),u.logTimer},function(){t.cancel(u.logTimer),u.logTimer=undefined})}function S(e,t,n){var r={backwards:n,offset:t,max:e,instanceId:u.logSession.id};return i.getSessionLog(u.path,r).then(function(e){x(e,n)})}function x(e,t){if(e.log.length>0){var n=e.log.split(/\n(?=\d{4})/g);t?(u.log=n.concat(u.log),u.logStartOffset=e.startOffset,u.logEndOffset=Math.max(u.logEndOffset,e.endOffset)):(u.log=u.log.concat(n),u.logStartOffset=Math.min(u.logStartOffset,e.startOffset),u.logEndOffset=e.endOffset)}}function T(e){return r.recordSession(u.path,e.id).then(function(){a()})}function N(e){n.url("/dashboard/playback/"+u.path+"?playback="+e)}function C(){n.path("/dashboard/single/"+u.path),t.cancel(u.timer)}function k(){n.path("/config/swing/"+u.path),t.cancel(u.timer)}function L(e,t){window.open(r.getStackDumpPath(u.path,e.id,t),"_blank")}function A(e){r.requestThreadDump(u.path,e.id)}function O(e){return e.warnings&&e.warnings.length>0||e.warningHistory.length>0||Object.keys(e.threadDumps).length>0}var u=this;u.path=s.path,u.sessions=[],u.closedSessions=[],u.recordings=[],u.log=[],u.view=y,u.record=T,u.lastUpdated=null,u.refresh=a,u.timer=undefined,u.logTimer=undefined,u.logEndOffset=-1,u.play=N,u.back=C,u.kill=g,u.toConfig=k,u.sortExp="startedAt",u.sortReverse=!0,u.sortBy=f,u.sortByMetrics=l,u.sortByBandwidth=h,u.sortByLatency=c,u.sortFinishedExp="endedAt",u.sortFinishedReverse=!0,u.sortFinishedBy=p,u.getOsIcon=d,u.getBrowserIcon=v,u.loadSessionLogs=b,u.stopLogs=w,u.split=m,u.showThreadDump=L,u.requestThreadDump=A,u.hasWarnings=O,u.sessionLoggingEnabled=!1,a(),e.$on("$destroy",function(){t.cancel(u.timer),t.cancel(u.logTimer)}),e.$watch("vm.sessions",function(e){if(e!=null)for(var t=0;t<e.length;t++){var n=e[t];n.gauge={},n.gauge.cpu=o.getGaugeData(n.metrics,"Cpu","%","cpuUtilization",null,100,1)}})}return t.$inject=["$scope","$timeout","$location","sessionsRestService","logRestService","$routeParams","wsUtils"],t})})(adminConsole.define);