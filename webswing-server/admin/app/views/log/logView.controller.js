(function(e){e([],function(){function t(e,t,n,r,i,s,o){function a(){return f(102400,u.endOffset,!1).then(function(e){t.cancel(u.timer)}).then(function(){return u.timer&&t.cancel(u.timer),u.timer=t(a,1e3),u.timer},function(){t.cancel(u.timer),u.timer=undefined})}function f(e,t,n){var r={backwards:n,offset:t,max:e};return S(u.type)?(r.instanceId=u.instanceId||null,s.getSessionLog(u.app,r).then(function(e){l(e,n)})):s.getLog(u.type.url,r).then(function(e){l(e,n)})}function l(e,t){if(e.log&&e.log.length>0){var n=e.log.split(u.type.lineDelimiter);t?(u.log=n.concat(u.log),u.startOffset=e.startOffset,u.endOffset=Math.max(u.endOffset,e.endOffset)):(u.log=u.log.concat(n),u.startOffset=Math.min(u.startOffset,e.startOffset),u.endOffset=e.endOffset)}u.lastUpdated=new Date}function c(){if(!u.type||!S(u.type)){u.apps=[];return}return s.getSessionLogApps().then(function(e){u.apps=e,u.apps&&u.apps.length&&(!u.app||!u.app.length)&&(u.app=u.apps[0].url,h())})}function h(){if(!u.type||!S(u.type)||!u.app||!u.app.length){u.appInstanceIds=[];return}return s.getSessionLogInstanceIds(u.app).then(function(e){u.appInstanceIds=e})}function p(e){return u.type.delimiter!=null?e.split(u.type.delimiter):[e]}function d(){for(var e=0;e<u.types.length;e++){var t=u.types[e];if(t.url===u.path)return t}return v(u.types[0])}function v(e){if(g(e))return;n.path("/logs/"+e.url),n.search("app",null),n.search("instanceId",null)}function m(e,t,r){n.path("/logs/"+e.url),n.search("app",t),n.search("instanceId",r||null)}function g(e){return u.type&&u.type.label===e.label}function y(e){return u.app&&u.app==e.url}function b(e){return u.instanceId&&u.instanceId==e}function w(e){window.open(o+"/rest/logs/"+e.url,"_blank")}function E(e){window.open(x(e)+"/rest/logs/session","_blank")}function S(e){return e.url=="session"}function x(e){return e.substr(0,4)==="http"?e:(e.substr(0,1)!=="/"&&(e="/"+e),e.length===1&&(e=""),e)}var u=this;u.path=r.path,u.path&&(u.path=u.path.replace(/\/$/,"")),u.types=[{label:"Audit",url:"audit",delimiter:"|",lineDelimiter:"\n",headers:["Timestamp","Result","User","Detail","Secured path","Protocol","Source IP","Module"],downloadEnabled:!0},{label:"Server",url:"server",delimiter:null,lineDelimiter:/\n(?=\d{4})/g,headers:["Messages"],downloadEnabled:!0},{label:"Session",url:"session",delimiter:null,lineDelimiter:/\n(?=\d{4})/g,headers:["Messages"],downloadEnabled:!1}],u.showLog=v,u.showAppLog=m,u.isActive=g,u.isActiveApp=y,u.isActiveAppInstanceId=b,u.isSessionType=S,u.split=p,u.timer=undefined,u.filter="",u.endOffset=-1,u.log=[],u.download=w,u.downloadSessionLogs=E,u.apps=[],u.appInstanceIds=[],u.instanceIdTimer,u.type=d(),u.app=n.search().app,u.instanceId=n.search().instanceId,c(),h(),u.type&&(!S(u.type)||u.app&&u.instanceId)&&f(102400,-1,!0).then(function(){t(function(){n.hash("endOfPageAnchor"),i()},100)}).then(a),e.$on("$destroy",function(){t.cancel(u.timer)}),e.$watch("vm.instanceId",function(e,r){u.instanceId=e,u.instanceIdTimer&&t.cancel(u.instanceIdTimer),u.log=[],u.type&&S(u.type)&&e&&e!==r&&e!=null&&(u.instanceIdTimer=t(function(){u.timer&&t.cancel(u.timer),f(102400,-1,!0).then(function(){t(function(){n.hash("endOfPageAnchor"),i()},100)}).then(a)},500))})}return t.$inject=["$scope","$timeout","$location","$routeParams","$anchorScroll","logRestService","baseUrl"],t})})(adminConsole.define);