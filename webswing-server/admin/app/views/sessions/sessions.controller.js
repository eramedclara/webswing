(function(e){e([],function(){function t(e,t,n,r,i,s,o,u,a,f){function c(){i.getSessions(l.appFilter).then(function(e){l.sessions=e.sessions||[],l.closedSessions=e.closedSessions||[],l.recordings=e.recordings||[],l.lastUpdated=new Date}).then(function(){return l.timer=t(c,5e3),l.timer},function(){t.cancel(l.timer),l.timer=undefined}),i.getStats(l.appFilter).then(function(e){l.memoryStats=p(e),l.cpuStats=m(e),l.bandwidthStats=d(e),l.latencyStats=v(e)}),r.getPaths().then(function(e){l.paths=e.sort(function(e,t){var n=e.name||"",r=t.name||"";return n===r?0:n<r?-1:1})})}function h(e,n){t.cancel(l.timer),u[e]=n,o.updateParams(u)}function p(e){return{names:["Total Max Memory","Total Used Memory"],keys:["memoryAllocated.SUM","memoryUsed.SUM"],dataset:a.getStatsDataset(e,["memoryAllocated.SUM","memoryUsed.SUM"]),tickFormat:function(e,t){return e>999?(e/1024).toFixed(1)+"GB":e+"MB"}}}function d(e){return{names:["Total Inbound trafic","Total Outbound trafic"],keys:["inboundSize.SUM","outboundSize.SUM"],dataset:a.getStatsDataset(e,["inboundSize.SUM","outboundSize.SUM"]),tickFormat:function(e,t){return e>1022976?(e/1024/1024).toFixed(1)+"m":Math.floor(e/1024)+"k"}}}function v(e){return{names:["Avg Ping latency","Avg Server rendering latency","Avg Client rendering latency","Max End-to-End Latency"],keys:["latencyPing.AVG","latencyServerRendering.AVG","latencyClientRendering.AVG","latency.MAX"],dataset:a.getStatsDataset(e,["latencyPing.AVG","latencyServerRendering.AVG","latencyClientRendering.AVG","latency.MAX"]),tickFormat:function(e,t){return e+"ms"}}}function m(e){return{names:["Sessions CPU Utilization","Server CPU Utilization","Total CPU Utilization"],keys:["cpuUtilizationSession.SUM","cpuUtilizationServer.SUM","cpuUtilization.SUM"],dataset:a.getStatsDataset(e,["cpuUtilizationSession.SUM","cpuUtilizationServer.SUM","cpuUtilization.SUM"]),tickFormat:function(e,t){return Math.floor(e)+"%"}}}function g(e){if(e!=null)return e==="Windows"?"wsa-icon-windows":e==="Mac"||e==="IPhone"?"wsa-icon-apple":e==="Linux"?"wsa-icon-linux":e==="Android"?"wsa-icon-android":"wsa-icon-unknown"}function y(e){if(e!=null)return e.indexOf("IE")>=0?"wsa-icon-ie":e.indexOf("Safari")>=0?"wsa-icon-safari":e.indexOf("Opera")>=0?"wsa-icon-opera":e.indexOf("Chrome")>=0?"wsa-icon-chrome":e.indexOf("Firefox")>=0?"wsa-icon-firefox":"wsa-icon-unknown"}function b(e){l.sortExp===e?l.sortReverse=!l.sortReverse:(l.sortExp=e,l.sortReverse=!1)}function w(e){return l.sortExp===e&&!l.sortReverse}function E(e){return l.sortExp===e&&l.sortReverse}function S(e){var t="metrics.memoryUsed";return e!=null&&(t="metrics['memoryUsed."+e+"']"),t}function x(e){var t="metrics.latency";return e!=null&&(t="metrics['latency."+e+"']"),t}function T(e){var t="metrics.inboundSize + metrics.outboundSize";return e!=null&&(t="metrics['inboundSize."+e+"'] + metrics['outboundSize."+e+"']"),t}function N(e){l.sortFinishedExp===e?l.sortFinishedReverse=!l.sortFinishedReverse:(l.sortFinishedExp=e,l.sortFinishedReverse=!1)}function C(e){return l.sortFinishedExp===e&&!l.sortFinishedReverse}function k(e){return l.sortFinishedExp===e&&l.sortFinishedReverse}function L(e){return i.killSession(e.applicationUrl,e.id).then(function(){c()})}function A(e){n.url("/dashboard/session"+e.applicationUrl+"?id="+e.id)}function O(e){M(),l.logSession=e,l.log=[],D(e.applicationUrl,102400,-1,!0).then(function(){_(e.applicationUrl)})}function M(){l.logTimer&&t.cancel(l.logTimer),l.log=[]}function _(e){return D(e,102400,l.logEndOffset,!1).then(function(e){t.cancel(l.logTimer)}).then(function(){return l.logTimer&&t.cancel(l.logTimer),l.logTimer=t(function(){_(e)},1e3),l.logTimer},function(){t.cancel(l.logTimer),l.logTimer=undefined})}function D(e,t,n,r){var i={backwards:r,offset:n,max:t,instanceId:l.logSession.id};return s.getSessionLog(e,i).then(function(e){P(e,r)})}function P(e,t){if(e.log.length>0){var n=e.log.split(/\n(?=\d{4})/g);t?(l.log=n.concat(l.log),l.logStartOffset=e.startOffset,l.logEndOffset=Math.max(l.logEndOffset,e.endOffset)):(l.log=l.log.concat(n),l.logStartOffset=Math.min(l.logStartOffset,e.startOffset),l.logEndOffset=e.endOffset)}}function H(e){return e.split(/\n(?=\d{4})/g)}function B(e){return i.recordSession(e.applicationUrl,e.id).then(function(){c()})}function j(e,t){n.url("/dashboard/playback"+e.applicationUrl+"?playback="+t)}function F(e){l.appFilter&&l.appFilter.length&&n.url("/dashboard/playback"+l.appFilter+"?playback="+e)}function I(e,t){window.open(i.getStackDumpPath(e.applicationUrl,e.id,t),"_blank")}function q(e){i.requestThreadDump(e.applicationUrl,e.id)}function R(e){return e.warnings&&e.warnings.length>0||e.warningHistory.length>0||Object.keys(e.threadDumps).length>0}var l=this;l.appFilter=u.app,l.appFilter&&l.appFilter.substr(0,1)!=="/"&&(l.appFilter="/"+l.appFilter),l.paths=[],l.sortExp="startedAt",l.sortReverse=!0,l.sortBy=b,l.isSortByAsc=w,l.isSortByDesc=E,l.getSortByMetricsExpr=S,l.getSortByBandwidthExpr=T,l.getSortByLatencyExpr=x,l.sortFinishedExp="endedAt",l.sortFinishedReverse=!0,l.sortFinishedBy=N,l.isSortFinishedByAsc=C,l.isSortFinishedByDesc=k,l.searchAppFilter="",l.sessions=[],l.closedSessions=[],l.recordings=[],l.log=[],l.lastUpdated=null,l.refresh=c,l.getOsIcon=g,l.getBrowserIcon=y,l.filter=h,l.view=A,l.record=B,l.play=j,l.playOther=F,l.kill=L,l.sessionTab="running",l.showThreadDump=I,l.requestThreadDump=q,l.hasWarnings=R,l.logTimer=undefined,l.logEndOffset=-1,l.loadSessionLogs=O,l.stopLogs=M,l.split=H,l.now=function(){return(new Date).getTime()},c(),e.$on("$destroy",function(){t.cancel(l.timer),t.cancel(l.logTimer)})}return t.$inject=["$scope","$timeout","$location","configRestService","sessionsRestService","logRestService","$route","$routeParams","wsUtils","baseUrl"],t})})(adminConsole.define);