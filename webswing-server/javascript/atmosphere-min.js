(function(e,t){typeof webswingRequirejs.define=="function"&&webswingRequirejs.define.amd?webswingRequirejs.define(t):typeof exports!="undefined"?module.exports=t():e.atmosphere=t()})(this,function(){var e={},t,n=!1,r=[],i=[],s=0,o=Object.prototype.hasOwnProperty;return e={version:"2.3.8-javascript",onError:function(e){},onClose:function(e){},onOpen:function(e){},onReopen:function(e){},onMessage:function(e){},onReconnect:function(e,t){},onMessagePublished:function(e){},onTransportFailure:function(e,t){},onLocalMessage:function(e){},onFailureToReconnect:function(e,t){},onClientTimeout:function(e){},onOpenAfterResume:function(e){},WebsocketApiAdapter:function(t){var n,r;return t.onMessage=function(e){r.onmessage({data:e.responseBody})},t.onMessagePublished=function(e){r.onmessage({data:e.responseBody})},t.onOpen=function(e){r.onopen(e)},r={close:function(){n.close()},send:function(e){n.push(e)},onmessage:function(e){},onopen:function(e){},onclose:function(e){},onerror:function(e){}},n=new e.subscribe(t),r},AtmosphereRequest:function(t){function k(){v=!0,b=!1,m=0,u=null,l=null,h=null,p=null}function L(){P(),k()}function A(e){return e=="debug"?r.logLevel==="debug":e=="info"?r.logLevel==="info"||r.logLevel==="debug":e=="warn"?r.logLevel==="warn"||r.logLevel==="info"||r.logLevel==="debug":e=="error"?r.logLevel==="error"||r.logLevel==="warn"||r.logLevel==="info"||r.logLevel==="debug":!1}function O(t){A("debug")&&e.util.debug(new Date+" Atmosphere: "+t)}function M(e,t){return o.partialMessage===""&&t.transport==="streaming"&&e.responseText.length>t.maxStreamingLength?!0:!1}function _(){if(r.enableProtocol&&!r.disableDisconnect&&!r.firstMessage){var t="X-Atmosphere-Transport=close&X-Atmosphere-tracking-id="+r.uuid;e.util.each(r.headers,function(n,i){var s=e.util.isFunction(i)?i.call(this,r,r,o):i;s!=null&&(t+="&"+encodeURIComponent(n)+"="+encodeURIComponent(s))});var n=r.url.replace(/([?&])_=[^&]*/,t);n+=n===r.url?(/\?/.test(r.url)?"&":"?")+t:"";var i={connected:!1},s=new e.AtmosphereRequest(i);s.connectTimeout=r.connectTimeout,s.attachHeadersAsQueryString=!1,s.dropHeaders=!0,s.url=n,s.contentType="text/plain",s.transport="polling",s.method="GET",s.data="",s.heartbeat=null,r.enableXDR&&(s.enableXDR=r.enableXDR),s.async=r.closeAsync,vt("",s)}}function D(){O("Closing (AtmosphereRequest._close() called)"),b=!0,r.reconnectId&&(clearTimeout(r.reconnectId),delete r.reconnectId),r.heartbeatTimer&&clearTimeout(r.heartbeatTimer),r.reconnect=!1,o.request=r,o.state="unsubscribe",o.responseBody="",o.status=408,o.partialMessage="",r.curWebsocketErrorRetries=0,Ot(),_(),P()}function P(){o.partialMessage="",r.id&&clearTimeout(r.id),r.heartbeatTimer&&clearTimeout(r.heartbeatTimer),r.reconnectId&&(clearTimeout(r.reconnectId),delete r.reconnectId),p!=null&&(p.close(),p=null),d!=null&&(d.abort(),d=null),h!=null&&(h.abort(),h=null),u!=null&&(u.canSendMessage&&(O("invoking .close() on WebSocket object"),u.close()),u=null),l!=null&&(l.close(),l=null),H()}function H(){E!=null&&(clearInterval(T),document.cookie=N+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/",E.signal("close",{reason:"",heir:b?(E.get("children")||[])[0]:x}),E.close()),S!=null&&S.close()}function B(t){L(),r=e.util.extend(r,t),r.mrequest=r.reconnect,r.reconnect||(r.reconnect=!0)}function j(){return r.webSocketImpl!=null||window.WebSocket||window.MozWebSocket}function F(){var t=e.util.getAbsoluteURL(r.url.toLowerCase()),n=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/.exec(t),i=!(!n||n[1]==window.location.protocol&&n[2]==window.location.hostname&&(n[3]||(n[1]==="http:"?80:443))==(window.location.port||(window.location.protocol==="http:"?80:443)));return window.EventSource&&(!i||!e.util.browser.safari||e.util.browser.vmajor>=7)}function I(){if(r.shared){S=q(r);if(S!=null){A("debug")&&e.util.debug("Storage service available. All communication will be local");if(S.open(r))return}A("debug")&&e.util.debug("No Storage service available."),S=null}r.firstMessage=s==0?!0:!1,r.isOpen=!1,r.ctime=e.util.now(),r.uuid===0&&(r.uuid=s),o.closedByClientTimeout=!1,r.transport!=="websocket"&&r.transport!=="sse"?it(r):r.transport==="websocket"?j()?J(!1):et("Websocket is not supported, using request.fallbackTransport ("+r.fallbackTransport+")"):r.transport==="sse"&&(F()?$(!1):et("Server Side Events(SSE) is not supported, using request.fallbackTransport ("+r.fallbackTransport+")"))}function q(t){function f(e,t){var n,r=e.length;for(n=0;n<r;n++)e[n]===t&&e.splice(n,1);return r!==e.length}function l(e){var n=JSON.parse(e),i=n.data;if(n.target==="c")switch(n.type){case"open":U("opening","local",r);break;case"close":s||(s=!0,i.reason==="aborted"?D():i.heir===x?I():setTimeout(function(){I()},100));break;case"message":Nt(i,"messageReceived",200,t.transport);break;case"localMessage":Tt(i)}}function c(){var e=(new RegExp("(?:^|; )("+encodeURIComponent(o)+")=([^;]*)")).exec(document.cookie);if(e)return JSON.parse(decodeURIComponent(e[2]))}var n,i,s,o="atmosphere-"+t.url,u={storage:function(){function n(e){e.key===o&&e.newValue&&l(e.newValue)}if(!e.util.storage)return;var r=window.localStorage,i=function(e){var t=r.getItem(o+"-"+e);return t===null?[]:JSON.parse(t)},s=function(e,t){r.setItem(o+"-"+e,JSON.stringify(t))};return{init:function(){return s("children",i("children").concat([x])),e.util.on(window,"storage",n),i("opened")},signal:function(e,t){r.setItem(o,JSON.stringify({target:"p",type:e,data:t}))},close:function(){var r=i("children");e.util.off(window,"storage",n),r&&f(r,t.id)&&s("children",r)}}},windowref:function(){var e=window.open("",o.replace(/\W/g,""));if(!e||e.closed||!e.callbacks)return;return{init:function(){return e.callbacks.push(l),e.children.push(x),e.opened},signal:function(t,n){!e.closed&&e.fire&&e.fire(JSON.stringify({target:"p",type:t,data:n}))},close:function(){s||(f(e.callbacks,l),f(e.children,x))}}}};n=c();if(!n||e.util.now()-n.ts>1e3)return;i=u.storage()||u.windowref();if(!i)return;return{open:function(){var e;return T=setInterval(function(){var e=n;n=c(),(!n||e.ts===n.ts)&&l(JSON.stringify({target:"c",type:"close",data:{reason:"error",heir:e.heir}}))},1e3),e=i.init(),e&&setTimeout(function(){U("opening","local",t)},50),e},send:function(e){i.signal("send",e)},localSend:function(e){i.signal("localSend",JSON.stringify({id:x,event:e}))},close:function(){b||(clearInterval(T),i.signal("close"),i.close())}}}function R(){function s(e){var t=JSON.parse(e),n=t.data;if(t.target==="p")switch(t.type){case"send":dt(n);break;case"localSend":Tt(n);break;case"close":D()}}function o(){document.cookie=N+"="+encodeURIComponent(JSON.stringify({ts:e.util.now()+1,heir:(t.get("children")||[])[0]}))+"; path=/"}var t,n="atmosphere-"+r.url,i={storage:function(){function t(e){e.key===n&&e.newValue&&s(e.newValue)}if(!e.util.storage)return;var r=window.localStorage;return{init:function(){e.util.on(window,"storage",t)},signal:function(e,t){r.setItem(n,JSON.stringify({target:"c",type:e,data:t}))},get:function(e){return JSON.parse(r.getItem(n+"-"+e))},set:function(e,t){r.setItem(n+"-"+e,JSON.stringify(t))},close:function(){e.util.off(window,"storage",t),r.removeItem(n),r.removeItem(n+"-opened"),r.removeItem(n+"-children")}}},windowref:function(){var e=n.replace(/\W/g,""),t=document.getElementById(e),r;return t||(t=document.createElement("div"),t.id=e,t.style.display="none",t.innerHTML='<iframe name="'+e+'" />',document.body.appendChild(t)),r=t.firstChild.contentWindow,{init:function(){r.callbacks=[s],r.fire=function(e){var t;for(t=0;t<r.callbacks.length;t++)r.callbacks[t](e)}},signal:function(e,t){!r.closed&&r.fire&&r.fire(JSON.stringify({target:"c",type:e,data:t}))},get:function(e){return r.closed?null:r[e]},set:function(e,t){r.closed||(r[e]=t)},close:function(){}}}};w=function(n){t.signal("message",n)},t=i.storage()||i.windowref(),t.init(),A("debug")&&e.util.debug("Installed StorageService "+t),t.set("children",[]),t.get("opened")!=null&&!t.get("opened")&&t.set("opened",!1),N=encodeURIComponent(n),o(),T=setInterval(o,1e3),E=t}function U(e,t,n){r.shared&&t!=="local"&&R(),E!=null&&E.set("opened",!0),n.close=function(){D()};if(m>0&&e==="re-connecting")n.isReopen=!0,at(o);else if(o.error==null){o.request=n;var i=o.state;o.state=e;var s=o.transport;o.transport=t;var u=o.responseBody;Ot(),o.responseBody=u,o.state=i,o.transport=s}}function z(t){t.transport="jsonp";var n=r,i;t!=null&&typeof t!="undefined"&&(n=t),d={open:function(){function u(){n.lastIndex=0,n.openId&&clearTimeout(n.openId),n.heartbeatTimer&&clearTimeout(n.heartbeatTimer),n.reconnect&&m++<n.maxReconnectOnClose?(U("re-connecting",n.transport,n),ut(d,n,t.reconnectInterval),n.openId=setTimeout(function(){nt(n)},n.reconnectInterval+1e3)):Y(0,"maxReconnectOnClose reached")}function f(){var e=n.url;n.dispatchUrl!=null&&(e+=n.dispatchUrl);var r=n.data;n.attachHeadersAsQueryString&&(e=tt(n),r!==""&&(e+="&X-Atmosphere-Post-Body="+encodeURIComponent(r)),r="");var o=document.head||document.getElementsByTagName("head")[0]||document.documentElement;i=document.createElement("script"),i.src=e+"&jsonpTransport="+s,i.clean=function(){i.clean=i.onerror=i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),++t.scriptCount===2&&(t.scriptCount=1,u())},i.onload=i.onreadystatechange=function(){O("jsonp.onload"),(!i.readyState||/loaded|complete/.test(i.readyState))&&i.clean()},i.onerror=function(){O("jsonp.onerror"),t.scriptCount=1,i.clean()},o.insertBefore(i,o.firstChild)}var s="atmosphere"+ ++x;window[s]=function(i){O("jsonp.window"),t.scriptCount=0;if(n.reconnect&&n.maxRequest===-1||n.requestCount++<n.maxRequest){n.executeCallbackBeforeReconnect||ut(d,n,n.pollingInterval);if(i!=null&&typeof i!="string")try{i=i.message}catch(s){}var u=Z(i,n,o);u||Nt(o.responseBody,"messageReceived",200,n.transport),n.executeCallbackBeforeReconnect&&ut(d,n,n.pollingInterval),Q(n)}else e.util.log(r.logLevel,["JSONP reconnect maximum try reached "+r.requestCount]),Y(0,"maxRequest reached")},setTimeout(function(){f()},50)},abort:function(){i&&i.clean&&i.clean()}},d.open()}function W(e){return r.webSocketImpl!=null?r.webSocketImpl:window.WebSocket?new WebSocket(e):new MozWebSocket(e)}function X(){return tt(r,e.util.getAbsoluteURL(r.webSocketUrl||r.url)).replace(/^http/,"ws")}function V(){var e=tt(r);return e}function $(t){o.transport="sse";var n=V();A("debug")&&(e.util.debug("Invoking executeSSE"),e.util.debug("Using URL: "+n));if(t&&!r.reconnect){l!=null&&P();return}try{l=new EventSource(n,{withCredentials:r.withCredentials})}catch(i){Y(0,i),et("SSE failed. Downgrading to fallback transport and resending");return}r.connectTimeout>0&&(r.id=setTimeout(function(){t||P()},r.connectTimeout)),l.onopen=function(n){O("sse.onopen"),Q(r),A("debug")&&e.util.debug("SSE successfully opened"),r.enableProtocol?r.isReopen&&(r.isReopen=!1,U("re-opening",r.transport,r)):t?U("re-opening","sse",r):U("opening","sse",r),t=!0,r.method==="POST"&&(o.state="messageReceived",dt(r.data))},l.onmessage=function(t){O("sse.onmessage"),Q(r);if(!r.enableXDR&&window.location.host&&t.origin&&t.origin!==window.location.protocol+"//"+window.location.host){e.util.log(r.logLevel,["Origin was not "+window.location.protocol+"//"+window.location.host]);return}o.state="messageReceived",o.status=200,t=t.data;var n=Z(t,r,o);n||(Ot(),o.responseBody="",o.messages=[])},l.onerror=function(n){O("sse.onerror"),clearTimeout(r.id),r.heartbeatTimer&&clearTimeout(r.heartbeatTimer);if(o.closedByClientTimeout)return;At(t),P(),b?e.util.log(r.logLevel,["SSE closed normally"]):t?r.reconnect&&o.transport==="sse"&&(m++<r.maxReconnectOnClose?(U("re-connecting",r.transport,r),r.reconnectInterval>0?r.reconnectId=setTimeout(function(){$(!0)},r.reconnectInterval):$(!0),o.responseBody="",o.messages=[]):(e.util.log(r.logLevel,["SSE reconnect maximum try reached "+m]),Y(0,"maxReconnectOnClose reached"))):et("SSE failed. Downgrading to fallback transport and resending")}}function J(t){o.transport="websocket";var i=X(r.url);A("debug")&&e.util.debug("Invoking executeWebSocket, using URL: "+i);if(t&&!r.reconnect){u!=null&&P();return}u=W(i),r.webSocketBinaryType!=null&&(u.binaryType=r.webSocketBinaryType),r.connectTimeout>0&&(r.id=setTimeout(function(){if(!t){var e={code:1002,reason:"",wasClean:!1};u.onclose(e);try{P()}catch(n){}return}},r.connectTimeout)),u.onopen=function(i){O("websocket.onopen"),Q(r),n=!1,A("debug")&&e.util.debug("Websocket successfully opened");var s=t;u!=null&&(u.canSendMessage=!0),r.enableProtocol||(t=!0,s?U("re-opening","websocket",r):U("opening","websocket",r)),u!=null&&r.method==="POST"&&(o.state="messageReceived",u.send(r.data))},u.onmessage=function(e){O("websocket.onmessage"),Q(r),r.enableProtocol&&(t=!0),o.state="messageReceived",o.status=200,e=e.data;var n=typeof e=="string";if(n){var i=Z(e,r,o);i||(Ot(),o.responseBody="",o.messages=[])}else{e=K(r,e);if(e==="")return;o.responseBody=e,Ot(),o.responseBody=null}},u.onerror=function(e){O("websocket.onerror"),clearTimeout(r.id),r.heartbeatTimer&&clearTimeout(r.heartbeatTimer),r.curWebsocketErrorRetries++<r.maxWebsocketErrorRetries&&r.fallbackTransport!=="websocket"&&et("Failed to connect via Websocket. Downgrading to "+r.fallbackTransport+" and resending")},u.onclose=function(i){O("websocket.onclose"),clearTimeout(r.id);if(o.state==="closed")return;var s=i.reason;if(s==="")switch(i.code){case 1e3:s="Normal closure; the connection successfully completed whatever purpose for which it was created.";break;case 1001:s="The endpoint is going away, either because of a server failure or because the browser is navigating away from the page that opened the connection.";break;case 1002:s="The endpoint is terminating the connection due to a protocol error.";break;case 1003:s="The connection is being terminated because the endpoint received data of a type it cannot accept (for example, a text-only endpoint received binary data).";break;case 1004:s="The endpoint is terminating the connection because a data frame was received that is too large.";break;case 1005:s="Unknown: no status code was provided even though one was expected.";break;case 1006:s="Connection was closed abnormally (that is, with no close frame being sent)."}A("warn")&&e.util.warn("Websocket closed, reason: "+s+" - wasClean: "+i.wasClean);if(o.closedByClientTimeout||r.handleOnlineOffline&&n){r.reconnectId&&(clearTimeout(r.reconnectId),delete r.reconnectId);return}At(t),o.state="closed",b?e.util.log(r.logLevel,["Websocket closed normally"]):!t&&r.fallbackTransport!=="websocket"?et("Websocket failed on first connection attempt. Downgrading to "+r.fallbackTransport+" and resending"):r.reconnect&&o.transport==="websocket"&&(P(),m++<r.maxReconnectOnClose?(U("re-connecting",r.transport,r),r.reconnectInterval>0?r.reconnectId=setTimeout(function(){o.responseBody="",o.messages=[],J(!0)},r.reconnectInterval):(o.responseBody="",o.messages=[],J(!0))):(e.util.log(r.logLevel,["Websocket reconnect maximum try reached "+m]),A("warn")&&e.util.warn("Websocket error, reason: "+i.reason),Y(0,"maxReconnectOnClose reached")))};var s=navigator.userAgent.toLowerCase(),f=s.indexOf("android")>-1;f&&u.url===undefined&&u.onclose({reason:"Android 4.1 does not support websockets.",wasClean:!1})}function K(t,n){var i=n;if(t.transport==="polling")return i;if(t.enableProtocol&&t.firstMessage&&e.util.trim(n).length!==0){var o=t.trackMessageLength?1:0,u=n.split(t.messageDelimiter);if(u.length<=o+1)return i;t.firstMessage=!1,t.uuid=e.util.trim(u[o]),u.length<=o+2&&e.util.log("error",["Protocol data not sent by the server. If you enable protocol on client side, be sure to install JavascriptProtocol interceptor on server side.Also note that atmosphere-runtime 2.2+ should be used."]),g=parseInt(e.util.trim(u[o+1]),10),y=u[o+2],t.transport!=="long-polling"&&nt(t),s=t.uuid,i="",o=t.trackMessageLength?4:3;if(u.length>o+1)for(var f=o;f<u.length;f++)i+=u[f],f+1!==u.length&&(i+=t.messageDelimiter);t.ackInterval!==0&&setTimeout(function(){dt("...ACK...")},t.ackInterval)}else t.enableProtocol&&t.firstMessage&&e.util.browser.msie&&+e.util.browser.version.split(".")[0]<10?e.util.log(r.logLevel,["Receiving unexpected data from IE"]):nt(t);return i}function Q(e){clearTimeout(e.id),e.timeout>0&&e.transport!=="polling"&&(e.id=setTimeout(function(){G(e),_(),P()},e.timeout))}function G(e){o.closedByClientTimeout=!0,o.state="closedByClient",o.responseBody="",o.status=408,o.messages=[],Ot()}function Y(e,t){P(),clearTimeout(r.id),o.state="error",o.reasonPhrase=t,o.responseBody="",o.status=e,o.messages=[],Ot()}function Z(e,t,n){e=K(t,e);if(e.length===0)return!0;n.responseBody=e;if(t.trackMessageLength){e=n.partialMessage+e;var r=[],i=e.indexOf(t.messageDelimiter);if(i!=-1){while(i!==-1){var s=e.substring(0,i),o=+s;if(isNaN(o))throw n.partialMessage="",new Error('message length "'+s+'" is not a number');i+=t.messageDelimiter.length,i+o>e.length?i=-1:(r.push(e.substring(i,i+o)),e=e.substring(i+o,e.length),i=e.indexOf(t.messageDelimiter))}return n.partialMessage=e,r.length!==0?(n.responseBody=r.join(t.messageDelimiter),n.messages=r,!1):(n.responseBody="",n.messages=[],!0)}}return n.responseBody=e,n.messages=[e],!1}function et(t){e.util.log(r.logLevel,[t]),typeof r.onTransportFailure!="undefined"?r.onTransportFailure(t,r):typeof e.util.onTransportFailure!="undefined"&&e.util.onTransportFailure(t,r);var n=r.connectTimeout===-1?0:r.connectTimeout;r.reconnect&&r.transport!=="none"||r.transport==null?(r.transport=r.fallbackTransport,r.method=r.fallbackMethod,o.transport=r.fallbackTransport,o.state="",r.fallbackTransport="none",n>0?r.reconnectId=setTimeout(function(){I()},n):I()):Y(500,"Unable to reconnect with fallback transport")}function tt(t,n){var i=r;return t!=null&&typeof t!="undefined"&&(i=t),n==null&&(n=i.url),i.attachHeadersAsQueryString?n.indexOf("X-Atmosphere-Framework")!==-1?n:(n+=n.indexOf("?")!==-1?"&":"?",n+="X-Atmosphere-tracking-id="+i.uuid,n+="&X-Atmosphere-Framework="+e.version,n+="&X-Atmosphere-Transport="+i.transport,i.trackMessageLength&&(n+="&X-Atmosphere-TrackMessageSize=true"),i.heartbeat!==null&&i.heartbeat.server!==null&&(n+="&X-Heartbeat-Server="+i.heartbeat.server),i.contentType!==""&&(n+="&Content-Type="+(i.transport==="websocket"?i.contentType:encodeURIComponent(i.contentType))),i.enableProtocol&&(n+="&X-atmo-protocol=true"),e.util.each(i.headers,function(r,s){var u=e.util.isFunction(s)?s.call(this,i,t,o):s;u!=null&&(n+="&"+encodeURIComponent(r)+"="+encodeURIComponent(u))}),n):n}function nt(e){if(!e.isOpen)e.isOpen=!0,U("opening",e.transport,e);else if(e.isReopen)e.isReopen=!1,U("re-opening",e.transport,e);else{if(o.state!=="messageReceived"||e.transport!=="jsonp"&&e.transport!=="long-polling")return;ft(o)}rt(e)}function rt(t){t.heartbeatTimer!=null&&clearTimeout(t.heartbeatTimer);if(!isNaN(g)&&g>0){var n=function(){A("debug")&&e.util.debug("Sending heartbeat"),dt(y),t.heartbeatTimer=setTimeout(n,g)};t.heartbeatTimer=setTimeout(n,g)}}function it(t){var n=r;if(t!=null||typeof t!="undefined")n=t;n.lastIndex=0,n.readyState=0;if(n.transport==="jsonp"||n.enableXDR&&e.util.checkCORSSupport()){z(n);return}if(e.util.browser.msie&&+e.util.browser.version.split(".")[0]<10){if(n.transport==="streaming"){n.enableXDR&&window.XDomainRequest?lt(n):ht(n);return}if(n.enableXDR&&window.XDomainRequest){lt(n);return}}var i=function(e){n.lastIndex=0,m++;if(e||n.reconnect&&m<=n.maxReconnectOnClose){var r=e?0:t.reconnectInterval;o.ffTryingReconnect=!0,U("re-connecting",t.transport,t),ut(f,n,r)}else Y(0,"maxReconnectOnClose reached")},s=function(t){e._beforeUnloadState?(e.util.debug(new Date+" Atmosphere: reconnectF: execution delayed due to _beforeUnloadState flag"),setTimeout(function(){i(t)},5e3)):i(t)},u=function(){o.errorHandled=!0,P(),s(!1)};if(n.force||n.reconnect&&(n.maxRequest===-1||n.requestCount++<n.maxRequest)){n.force=!1;var f=e.util.xhr();f.hasData=!1,ot(f,n,!0),n.suspend&&(h=f),n.transport!=="polling"&&(o.transport=n.transport,f.onabort=function(){O("ajaxrequest.onabort"),At(!0)},f.onerror=function(){O("ajaxrequest.onerror"),o.error=!0,o.ffTryingReconnect=!0;try{o.status=XMLHttpRequest.status}catch(e){o.status=500}o.status||(o.status=500),o.errorHandled||(P(),s(!1))}),f.onreadystatechange=function(){O("ajaxRequest.onreadystatechange, new state: "+f.readyState);if(b){O("onreadystatechange has been ignored due to _abortingConnection flag");return}o.error=null;var i=!1,l=!1;if(n.transport==="streaming"&&n.readyState>2&&f.readyState===4){P(),s(!1);return}n.readyState=f.readyState,n.transport==="streaming"&&f.readyState>=3?l=!0:n.transport==="long-polling"&&f.readyState===4&&(l=!0),Q(r);if(n.transport!=="polling"){var c=200;f.readyState===4&&(c=f.status>1e3?0:f.status);if(!n.reconnectOnServerError&&c>=300&&c<600){Y(c,f.statusText);return}if(c>=300||c===0){u();return}(!n.enableProtocol||!t.firstMessage)&&f.readyState===2&&(e.util.browser.mozilla&&o.ffTryingReconnect?(o.ffTryingReconnect=!1,setTimeout(function(){o.ffTryingReconnect||nt(n)},500)):nt(n))}else f.readyState===4&&(l=!0);if(l){var h=f.responseText;o.errorHandled=!1;if(n.transport==="long-polling"&&e.util.trim(h).length===0){f.hasData?f.hasData=!1:s(!0);return}f.hasData=!0,Ct(f,r);if(n.transport==="streaming")if(!e.util.browser.opera){var p=h.substring(n.lastIndex,h.length);i=Z(p,n,o),n.lastIndex=h.length;if(i)return}else e.util.iterate(function(){if(o.status!==500&&f.responseText.length>n.lastIndex){try{o.status=f.status,o.headers=e.util.parseHeaders(f.getAllResponseHeaders()),Ct(f,r)}catch(t){o.status=404}Q(r),o.state="messageReceived";var s=f.responseText.substring(n.lastIndex);n.lastIndex=f.responseText.length,i=Z(s,n,o),i||Ot();if(M(f,n)){st(f,n);return}}else if(o.status>400)return n.lastIndex=f.responseText.length,!1},0);else i=Z(h,n,o);var d=M(f,n);try{o.status=f.status,o.headers=e.util.parseHeaders(f.getAllResponseHeaders()),Ct(f,n)}catch(v){o.status=404}n.suspend?o.state=o.status===0?"closed":"messageReceived":o.state="messagePublished";var m=!d&&t.transport!=="streaming"&&t.transport!=="polling";m&&!n.executeCallbackBeforeReconnect&&ut(f,n,n.pollingInterval),o.responseBody.length!==0&&!i&&Ot(),m&&n.executeCallbackBeforeReconnect&&ut(f,n,n.pollingInterval),d&&st(f,n)}};try{f.send(n.data),v=!0}catch(l){e.util.log(n.logLevel,["Unable to connect to "+n.url]),Y(0,l)}}else n.logLevel==="debug"&&e.util.log(n.logLevel,["Max re-connection reached."]),Y(0,"maxRequest reached")}function st(e,t){o.messages=[],t.isReopen=!0,D(),b=!1,ut(e,t,500)}function ot(t,n,i){var s=n.url;n.dispatchUrl!=null&&n.method==="POST"&&(s+=n.dispatchUrl),s=tt(n,s),s=e.util.prepareURL(s),i&&(t.open(n.method,s,n.async),n.connectTimeout>0&&(n.id=setTimeout(function(){n.requestCount===0&&(P(),Nt("Connect timeout","closed",200,n.transport))},n.connectTimeout))),r.withCredentials&&r.transport!=="websocket"&&"withCredentials"in t&&(t.withCredentials=!0),r.dropHeaders||(t.setRequestHeader("X-Atmosphere-Framework",e.version),t.setRequestHeader("X-Atmosphere-Transport",n.transport),n.heartbeat!==null&&n.heartbeat.server!==null&&t.setRequestHeader("X-Heartbeat-Server",t.heartbeat.server),n.trackMessageLength&&t.setRequestHeader("X-Atmosphere-TrackMessageSize","true"),t.setRequestHeader("X-Atmosphere-tracking-id",n.uuid),e.util.each(n.headers,function(r,s){var u=e.util.isFunction(s)?s.call(this,t,n,i,o):s;u!=null&&t.setRequestHeader(r,u)})),n.contentType!==""&&t.setRequestHeader("Content-Type",n.contentType)}function ut(e,t,n){if(o.closedByClientTimeout)return;if(t.reconnect||t.suspend&&v){var i=0;e&&e.readyState>1&&(i=e.status>1e3?0:e.status),o.status=i===0?204:i,o.reason=i===0?"Server resumed the connection or down.":"OK",clearTimeout(t.id),t.reconnectId&&(clearTimeout(t.reconnectId),delete t.reconnectId),n>0?r.reconnectId=setTimeout(function(){it(t)},n):it(t)}}function at(e){e.state="re-connecting",kt(e)}function ft(e){e.state="openAfterResume",kt(e),e.state="messageReceived"}function lt(e){e.transport!=="polling"?(p=ct(e),p.open()):ct(e).open()}function ct(t){var n=r;t!=null&&typeof t!="undefined"&&(n=t);var i=n.transport,s=0,u=new window.XDomainRequest,f=function(){n.transport==="long-polling"&&n.reconnect&&(n.maxRequest===-1||n.requestCount++<n.maxRequest)&&(u.status=200,lt(n))},l=n.rewriteURL||function(e){var t=/(?:^|;\s*)(JSESSIONID|PHPSESSID)=([^;]*)/.exec(document.cookie);switch(t&&t[1]){case"JSESSIONID":return e.replace(/;jsessionid=[^\?]*|(\?)|$/,";jsessionid="+t[2]+"$1");case"PHPSESSID":return e.replace(/\?PHPSESSID=[^&]*&?|\?|$/,"?PHPSESSID="+t[2]+"&").replace(/&$/,"")}return e};u.onprogress=function(){c(u)},u.onerror=function(){n.transport!=="polling"&&(P(),m++<n.maxReconnectOnClose?n.reconnectInterval>0?n.reconnectId=setTimeout(function(){U("re-connecting",t.transport,t),lt(n)},n.reconnectInterval):(U("re-connecting",t.transport,t),lt(n)):Y(0,"maxReconnectOnClose reached"))},u.onload=function(){};var c=function(t){clearTimeout(n.id);var r=t.responseText;r=r.substring(s),s+=r.length;if(i!=="polling"){Q(n);var u=Z(r,n,o);if(i==="long-polling"&&e.util.trim(r).length===0)return;n.executeCallbackBeforeReconnect&&f(),u||Nt(o.responseBody,"messageReceived",200,i),n.executeCallbackBeforeReconnect||f()}};return{open:function(){var e=n.url;n.dispatchUrl!=null&&(e+=n.dispatchUrl),e=tt(n,e),u.open(n.method,l(e)),n.method==="GET"?u.send():u.send(n.data),n.connectTimeout>0&&(n.id=setTimeout(function(){n.requestCount===0&&(P(),Nt("Connect timeout","closed",200,n.transport))},n.connectTimeout))},close:function(){u.abort()}}}function ht(e){p=pt(e),p.open()}function pt(t){var n=r;t!=null&&typeof t!="undefined"&&(n=t);var i,s=new window.ActiveXObject("htmlfile");s.open(),s.close();var u=n.url;return n.dispatchUrl!=null&&(u+=n.dispatchUrl),n.transport!=="polling"&&(o.transport=n.transport),{open:function(){var t=s.createElement("iframe");u=tt(n),n.data!==""&&(u+="&X-Atmosphere-Post-Body="+encodeURIComponent(n.data)),u=e.util.prepareURL(u),t.src=u,s.body.appendChild(t);var f=t.contentDocument||t.contentWindow.document;i=e.util.iterate(function(){try{if(!f.firstChild)return;var t=f.body?f.body.lastChild:f;t.omgThisIsBroken;var u=function(){var e=t.cloneNode(!0);e.appendChild(f.createTextNode("."));var n=e.innerText;return n=n.substring(0,n.length-1),n};if(!f.body||!f.body.firstChild||f.body.firstChild.nodeName.toLowerCase()!=="pre"){var l=f.head||f.getElementsByTagName("head")[0]||f.documentElement||f,c=f.createElement("script");c.text="document.write('<plaintext>')",l.insertBefore(c,l.firstChild),l.removeChild(c),t=f.body.lastChild}return n.closed&&(n.isReopen=!0),i=e.util.iterate(function(){var e=u();if(e.length>n.lastIndex){Q(r),o.status=200,o.error=null,t.innerText="";var i=Z(e,n,o);if(i)return"";Nt(o.responseBody,"messageReceived",200,n.transport)}n.lastIndex=0;if(f.readyState==="complete")return At(!0),U("re-connecting",n.transport,n),n.reconnectInterval>0?n.reconnectId=setTimeout(function(){ht(n)},n.reconnectInterval):ht(n),!1},null),!1}catch(h){return o.error=!0,U("re-connecting",n.transport,n),m++<n.maxReconnectOnClose?n.reconnectInterval>0?n.reconnectId=setTimeout(function(){ht(n)},n.reconnectInterval):ht(n):Y(0,"maxReconnectOnClose reached"),s.execCommand("Stop"),s.close(),!1}})},close:function(){i&&i(),s.execCommand("Stop"),At(!0)}}}function dt(t){S!=null?mt(t):h!=null||l!=null?yt(t):p!=null?bt(t):d!=null?wt(t):u!=null?xt(t):(Y(0,"No suspended connection available"),e.util.error("No suspended connection available. Make sure atmosphere.subscribe has been called and request.onOpen invoked before trying to push data"))}function vt(e,t){t||(t=St(e)),t.transport="polling",t.method="GET",t.withCredentials=!1,t.reconnect=!1,t.force=!0,t.suspend=!1,t.timeout=1e3,it(t)}function mt(e){S.send(e)}function gt(t){if(t.length===0)return;try{S?S.localSend(t):E&&E.signal("localMessage",JSON.stringify({id:x,event:t}))}catch(n){e.util.error(n)}}function yt(e){var t=St(e);it(t)}function bt(t){if(r.enableXDR&&e.util.checkCORSSupport()){var n=St(t);n.reconnect=!1,z(n)}else yt(t)}function wt(e){yt(e)}function Et(e){var t=e;return typeof t=="object"&&(t=e.data),t}function St(t){var n=Et(t),i={connected:!1,timeout:6e4,method:"POST",url:r.url,contentType:r.contentType,headers:r.headers,reconnect:!0,callback:null,data:n,suspend:!1,maxRequest:-1,logLevel:"info",requestCount:0,withCredentials:r.withCredentials,async:r.async,transport:"polling",isOpen:!0,attachHeadersAsQueryString:!0,enableXDR:r.enableXDR,uuid:r.uuid,dispatchUrl:r.dispatchUrl,enableProtocol:!1,messageDelimiter:"|",trackMessageLength:r.trackMessageLength,maxReconnectOnClose:r.maxReconnectOnClose,heartbeatTimer:r.heartbeatTimer,heartbeat:r.heartbeat};return typeof t=="object"&&(i=e.util.extend(i,t)),i}function xt(t){var n=e.util.isBinary(t)?t:Et(t),i;try{r.dispatchUrl!=null?i=r.webSocketPathDelimiter+r.dispatchUrl+r.webSocketPathDelimiter+n:i=n;if(!u.canSendMessage){e.util.error("WebSocket not connected.");return}u.send(i)}catch(s){u.onclose=function(e){},P(),et("Websocket failed. Downgrading to "+r.fallbackTransport+" and resending "+t),yt(t)}}function Tt(t){var n=JSON.parse(t);n.id!==x&&(typeof r.onLocalMessage!="undefined"?r.onLocalMessage(n.event):typeof e.util.onLocalMessage!="undefined"&&e.util.onLocalMessage(n.event))}function Nt(e,t,n,r){o.responseBody=e,o.transport=r,o.status=n,o.state=t,Ot()}function Ct(e,t){if(!t.readResponsesHeaders)t.enableProtocol||(t.uuid=x);else try{var n=e.getResponseHeader("X-Atmosphere-tracking-id");n&&n!=null&&(t.uuid=n.split(" ").pop())}catch(r){}}function kt(t){Lt(t,r),Lt(t,e.util)}function Lt(e,t){switch(e.state){case"messageReceived":O("Firing onMessage"),m=0,typeof t.onMessage!="undefined"&&t.onMessage(e),typeof t.onmessage!="undefined"&&t.onmessage(e);break;case"error":var n=typeof e.reasonPhrase!="undefined"?e.reasonPhrase:"n/a";O("Firing onError, reasonPhrase: "+n),typeof t.onError!="undefined"&&t.onError(e),typeof t.onerror!="undefined"&&t.onerror(e);break;case"opening":delete r.closed,O("Firing onOpen"),typeof t.onOpen!="undefined"&&t.onOpen(e),typeof t.onopen!="undefined"&&t.onopen(e);break;case"messagePublished":O("Firing messagePublished"),typeof t.onMessagePublished!="undefined"&&t.onMessagePublished(e);break;case"re-connecting":O("Firing onReconnect"),typeof t.onReconnect!="undefined"&&t.onReconnect(r,e);break;case"closedByClient":O("Firing closedByClient"),typeof t.onClientTimeout!="undefined"&&t.onClientTimeout(r);break;case"re-opening":delete r.closed,O("Firing onReopen"),typeof t.onReopen!="undefined"&&t.onReopen(r,e);break;case"fail-to-reconnect":O("Firing onFailureToReconnect"),typeof t.onFailureToReconnect!="undefined"&&t.onFailureToReconnect(r,e);break;case"unsubscribe":case"closed":var i=typeof r.closed!="undefined"?r.closed:!1;i?O("Request already closed, not firing onClose ("+e.state+" case)"):(O("Firing onClose ("+e.state+" case)"),typeof t.onClose!="undefined"&&t.onClose(e),typeof t.onclose!="undefined"&&t.onclose(e)),r.closed=!0;break;case"openAfterResume":typeof t.onOpenAfterResume!="undefined"&&t.onOpenAfterResume(r)}}function At(e){o.state!=="closed"&&(o.state="closed",o.responseBody="",o.messages=[],o.status=e?200:501,Ot())}function Ot(){var t=function(e,t){t(o)};S==null&&w!=null&&w(o.responseBody),r.reconnect=r.mrequest;var n=typeof o.responseBody=="string",s=n&&r.trackMessageLength?o.messages.length>0?o.messages:[""]:new Array(o.responseBody);for(var u=0;u<s.length;u++){if(s.length>1&&s[u].length===0)continue;o.responseBody=n?e.util.trim(s[u]):s[u],S==null&&w!=null&&w(o.responseBody);if((o.responseBody.length===0||n&&y===o.responseBody)&&o.state==="messageReceived")continue;kt(o);if(i.length>0){A("debug")&&e.util.debug("Invoking "+i.length+" global callbacks: "+o.state);try{e.util.each(i,t)}catch(l){e.util.log(r.logLevel,["Callback exception"+l])}}if(typeof r.callback=="function"){A("debug")&&e.util.debug("Invoking request callbacks");try{r.callback(o)}catch(l){e.util.log(r.logLevel,["Callback exception"+l])}}}}var r={timeout:3e5,method:"GET",headers:{},contentType:"",callback:null,url:"",data:"",suspend:!0,maxRequest:-1,reconnect:!0,maxStreamingLength:1e7,lastIndex:0,logLevel:"info",requestCount:0,fallbackMethod:"GET",fallbackTransport:"streaming",transport:"long-polling",webSocketImpl:null,webSocketBinaryType:null,dispatchUrl:null,webSocketPathDelimiter:"@@",enableXDR:!1,rewriteURL:!1,attachHeadersAsQueryString:!0,executeCallbackBeforeReconnect:!1,readyState:0,withCredentials:!1,trackMessageLength:!1,messageDelimiter:"|",connectTimeout:-1,reconnectInterval:0,dropHeaders:!0,uuid:0,async:!0,shared:!1,readResponsesHeaders:!1,maxReconnectOnClose:5,enableProtocol:!0,disableDisconnect:!1,pollingInterval:0,heartbeat:{client:null,server:null},ackInterval:0,closeAsync:!1,reconnectOnServerError:!0,handleOnlineOffline:!0,maxWebsocketErrorRetries:1,curWebsocketErrorRetries:0,onError:function(e){},onClose:function(e){},onOpen:function(e){},onMessage:function(e){},onReopen:function(e,t){},onReconnect:function(e,t){},onMessagePublished:function(e){},onTransportFailure:function(e,t){},onLocalMessage:function(e){},onFailureToReconnect:function(e,t){},onClientTimeout:function(e){},onOpenAfterResume:function(e){}},o={status:200,reasonPhrase:"OK",responseBody:"",messages:[],headers:[],state:"messageReceived",transport:"polling",error:null,request:null,partialMessage:"",errorHandled:!1,closedByClientTimeout:!1,ffTryingReconnect:!1},u=null,l=null,h=null,p=null,d=null,v=!0,m=0,g=0,y="X",b=!1,w=null,E,S=null,x=e.util.now(),T,N,C=!1;B(t),this.subscribe=function(e){B(e),I()},this.execute=function(){I()},this.close=function(){D()},this.disconnect=function(){_()},this.getUrl=function(){return r.url},this.push=function(e,t){if(t!=null){var n=r.dispatchUrl;r.dispatchUrl=t,dt(e),r.dispatchUrl=n}else dt(e)},this.getUUID=function(){return r.uuid},this.pushLocal=function(e){gt(e)},this.enableProtocol=function(e){return r.enableProtocol},this.init=function(){k()},this.request=r,this.response=o}},e.subscribe=function(t,n,i){typeof n=="function"&&e.addCallback(n),typeof t!="string"?i=t:i.url=t,s=typeof i!="undefined"&&typeof i.uuid!="undefined"?i.uuid:0;var o=new e.AtmosphereRequest(i);return o.execute(),r[r.length]=o,o},e.unsubscribe=function(){if(r.length>0){var e=[].concat(r);for(var t=0;t<e.length;t++){var n=e[t];n.close(),clearTimeout(n.response.request.id),n.heartbeatTimer&&clearTimeout(n.heartbeatTimer)}}r=[],i=[]},e.unsubscribeUrl=function(e){var t=-1;if(r.length>0)for(var n=0;n<r.length;n++){var i=r[n];if(i.getUrl()===e){i.close(),clearTimeout(i.response.request.id),i.heartbeatTimer&&clearTimeout(i.heartbeatTimer),t=n;break}}t>=0&&r.splice(t,1)},e.addCallback=function(t){e.util.inArray(t,i)===-1&&i.push(t)},e.removeCallback=function(t){var n=e.util.inArray(t,i);n!==-1&&i.splice(n,1)},e.util={browser:{},parseHeaders:function(e){var t,n=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,r={};while(t=n.exec(e))r[t[1]]=t[2];return r},now:function(){return(new Date).getTime()},isArray:function(e){return Object.prototype.toString.call(e)==="[object Array]"},inArray:function(e,t){if(!Array.prototype.indexOf){var n=t.length;for(var r=0;r<n;++r)if(t[r]===e)return r;return-1}return t.indexOf(e)},isBinary:function(e){return/^\[object\s(?:Blob|ArrayBuffer|.+Array)\]$/.test(Object.prototype.toString.call(e))},isFunction:function(e){return Object.prototype.toString.call(e)==="[object Function]"},getAbsoluteURL:function(e){if(typeof document.createElement=="undefined")return e;var t=document.createElement("div");return t.innerHTML='<a href="'+e+'"/>',encodeURI(decodeURI(t.firstChild.href))},prepareURL:function(t){var n=e.util.now(),r=t.replace(/([?&])_=[^&]*/,"$1_="+n);return r+(r===t?(/\?/.test(t)?"&":"?")+"_="+n:"")},trim:function(e){return String.prototype.trim?e.toString().trim():e.toString().replace(/(?:(?:^|\n)\s+|\s+(?:$|\n))/g,"").replace(/\s+/g," ")},param:function(t){function i(t,n){n=e.util.isFunction(n)?n():n==null?"":n,r.push(encodeURIComponent(t)+"="+encodeURIComponent(n))}function s(t,n){var r;if(e.util.isArray(n))e.util.each(n,function(e,n){/\[\]$/.test(t)?i(t,n):s(t+"["+(typeof n=="object"?e:"")+"]",n)});else if(Object.prototype.toString.call(n)==="[object Object]")for(r in n)s(t+"["+r+"]",n[r]);else i(t,n)}var n,r=[];for(n in t)s(n,t[n]);return r.join("&").replace(/%20/g,"+")},storage:function(){try{return!!window.localStorage&&!!window.StorageEvent}catch(e){return!1}},iterate:function(e,t){var n;return t=t||0,function r(){n=setTimeout(function(){if(e()===!1)return;r()},t)}(),function(){clearTimeout(n)}},each:function(t,n,r){if(!t)return;var i,s=0,o=t.length,u=e.util.isArray(t);if(r)if(u)for(;s<o;s++){i=n.apply(t[s],r);if(i===!1)break}else for(s in t){i=n.apply(t[s],r);if(i===!1)break}else if(u)for(;s<o;s++){i=n.call(t[s],s,t[s]);if(i===!1)break}else for(s in t){i=n.call(t[s],s,t[s]);if(i===!1)break}return t},extend:function(e){var t,n,r;for(t=1;t<arguments.length;t++)if((n=arguments[t])!=null)for(r in n)e[r]=n[r];return e},on:function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)},off:function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent&&e.detachEvent("on"+t,n)},log:function(e,t){if(window.console){var n=window.console[e];typeof n=="function"&&n.apply(window.console,t)}},warn:function(){e.util.log("warn",arguments)},info:function(){e.util.log("info",arguments)},debug:function(){e.util.log("debug",arguments)},error:function(){e.util.log("error",arguments)},xhr:function(){try{return new window.XMLHttpRequest}catch(e){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}},checkCORSSupport:function(){if(e.util.browser.msie&&!window.XDomainRequest&&+e.util.browser.version.split(".")[0]<11)return!0;if(e.util.browser.opera&&+e.util.browser.version.split(".")<12)return!0;if(e.util.trim(navigator.userAgent).slice(0,16)==="KreaTVWebKit/531")return!0;if(e.util.trim(navigator.userAgent).slice(-7).toLowerCase()==="kreatel")return!0;var t=navigator.userAgent.toLowerCase(),n=t.match(/.+android ([0-9]{1,2})/i),r=parseInt(n&&n[0]||-1,10);return!isNaN(r)&&r>-1&&r<3?!0:!1}},t=e.util.now(),function(){var t=navigator.userAgent.toLowerCase(),n=/(chrome)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||/(trident)(?:.*? rv:([\w.]+)|)/.exec(t)||t.indexOf("android")<0&&/version\/(.+) (safari)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[];n[2]==="safari"&&(n[2]=n[1],n[1]="safari"),e.util.browser[n[1]||""]=!0,e.util.browser.version=n[2]||"0",e.util.browser.vmajor=e.util.browser.version.split(".")[0],e.util.browser.trident&&(e.util.browser.msie=!0);if(e.util.browser.msie||e.util.browser.mozilla&&+e.util.browser.version.split(".")[0]===1)e.util.storage=!1}(),e.callbacks={unload:function(){e.util.debug(new Date+" Atmosphere: unload event"),e.unsubscribe()},beforeUnload:function(){e.util.debug(new Date+" Atmosphere: beforeunload event"),e._beforeUnloadState=!0,setTimeout(function(){e.util.debug(new Date+" Atmosphere: beforeunload event timeout reached. Reset _beforeUnloadState flag"),e._beforeUnloadState=!1},5e3)},offline:function(){e.util.debug(new Date+" Atmosphere: offline event"),n=!0;if(r.length>0){var t=[].concat(r);for(var i=0;i<t.length;i++){var s=t[i];s.request.handleOnlineOffline&&(s.close(),clearTimeout(s.response.request.id),s.heartbeatTimer&&clearTimeout(s.heartbeatTimer))}}},online:function(){e.util.debug(new Date+" Atmosphere: online event");if(r.length>0)for(var t=0;t<r.length;t++)r[t].request.handleOnlineOffline&&(r[t].init(),r[t].execute());n=!1}},e.bindEvents=function(){e.util.on(window,"unload",e.callbacks.unload),e.util.on(window,"beforeunload",e.callbacks.beforeUnload),e.util.on(window,"offline",e.callbacks.offline),e.util.on(window,"online",e.callbacks.online)},e.unbindEvents=function(){e.util.off(window,"unload",e.callbacks.unload),e.util.off(window,"beforeunload",e.callbacks.beforeUnload),e.util.off(window,"offline",e.callbacks.offline),e.util.off(window,"online",e.callbacks.online)},e.bindEvents(),e});