(function(e,t){typeof webswingRequirejs.define=="function"&&webswingRequirejs.define.amd?webswingRequirejs.define(["ProtoBuf","text!directdraw.proto"],t):e.WebswingDirectDraw=t(dcodeIO.ProtoBuf)})(this,function(e,t){return function(n){function b(e,t){return S(o.decode64(e),t)}function w(e,t){return S(o.decode(e),t)}function E(e,t){return S(e,t)}function S(e,t){return new Promise(function(n,i){try{x(e,t,n,i)}catch(s){r.onErrorMessage(s),i(s)}})}function x(e,t,n,i){var s,o=(new Date).getTime();t!=null?s=t:(s=document.createElement("canvas"),s.getContext("2d").scale(r.dpr,r.dpr));if(s.width!=e.width*r.dpr||s.height!=e.height*r.dpr)s.width=e.width*r.dpr,s.height=e.height*r.dpr;var u={canvas:s,graphicsStates:{},currentStateId:null},a=T(e.constants);at(a).then(function(){return ft(e.fontFaces)}).then(function(){var t=u.canvas.getContext("2d");r.logTrace&&(t=xt(t)),e.instructions!=null&&(t.save(),e.instructions.reduce(function(e,n){return e.then(function(e){return N(t,n,u)})},Promise.resolve()).then(function(){t.restore(),St(o,e),n(u.canvas)},function(e){t.restore(),i(e),r.onErrorMessage(e)}))},function(e){r.onErrorMessage(e)})}function T(e){var t=[];return e.forEach(function(e){v[e.id]=e,e.image!=null?t.push(e.image):e.texture!=null?t.push(e.texture.image):e.glyph!=null&&e.glyph.data!=null&&t.push(e.glyph)}),t}function N(e,t,n){var r=e,i=mt(t.args,v),s=n.graphicsStates[n.currentStateId],o=C(s);o&&(e=k(s,r));switch(t.inst){case u.GRAPHICS_CREATE:D(r,t.args[0],i,n);break;case u.GRAPHICS_SWITCH:M(r,t.args[0],n);break;case u.GRAPHICS_DISPOSE:O(t.args[0],n);break;case u.DRAW:P(e,i,s.transform);break;case u.FILL:H(e,i);break;case u.DRAW_IMAGE:B(e,i);break;case u.DRAW_WEBIMAGE:return j(e,i,t.webImage);case u.DRAW_STRING:I(e,i,s.fontTransform);break;case u.COPY_AREA:R(e,i);break;case u.SET_STROKE:s.strokeArgs=i,W(r,i);break;case u.SET_PAINT:s.paintArgs=i,X(r,i);break;case u.SET_COMPOSITE:s.compositeArgs=i,G(r,i);break;case u.SET_FONT:s.fontArgs=i,s.fontTransform=q(r,i);break;case u.TRANSFORM:s.transform=gt(s.transform,U(r,i));break;case u.DRAW_GLYPH_LIST:F(e,i);break;default:console.log("instruction code: "+t.inst+" not recognized")}if(o){var a=e.popBoundingBox(),f=ut(s.compositeArgs[0].composite.color);A(r,e,f,a)}return Promise.resolve()}function C(e){return e!=null&&e.compositeArgs!=null&&e.compositeArgs[0].composite.type==d.XOR_MODE}function k(e,t){y==null&&(y=document.createElement("canvas")),y.width=t.canvas.width,y.height=t.canvas.height;var n=y.getContext("2d");return L(n),_(e,n),n}function L(e){if(!e.wrapped){e.wrapped=!0,e.boundingBox=null,e.pathBBox=null;var t=e.beginPath;e.beginPath=function(){return this.pathBBox={},this.pathBBox.minX=this.pathBBox.minY=99999999999,this.pathBBox.maxX=this.pathBBox.maxY=-99999999999,t.call(this)};var n=e.setTransform;e.setTransform=function(e,t,r,i,s,o){return this.transfomMatrix=[e,t,r,i,s,o],n.call(this,e,t,r,i,s,o)};var r=e.transform;e.transform=function(e,t,n,i,s,o){return this.transfomMatrix=gt(this.transfomMatrix,[e,t,n,i,s,o]),r.call(this,e,t,n,i,s,o)},e.updateMinMax=function(e,t){var n=wt(e,t,this.transfomMatrix);n.x<this.pathBBox.minX&&(this.pathBBox.minX=n.x),n.x>this.pathBBox.maxX&&(this.pathBBox.maxX=n.x),n.y<this.pathBBox.minY&&(this.pathBBox.minY=n.y),n.y>this.pathBBox.maxY&&(this.pathBBox.maxY=n.y)};var i=e.fillText;e.fillText=function(e,t,n,r){this.pathBBox={},this.pathBBox.minX=this.pathBBox.minY=99999999999,this.pathBBox.maxX=this.pathBBox.maxY=-99999999999;var s=r||this.measureText(e).width,o=this.measureText("M").width*2;return this.updateMinMax(t-3,n-o*.7),this.updateMinMax(t-3,n+o*.3),this.updateMinMax(t+s*1.2,n-o*.7),this.updateMinMax(t+s*1.2,n+o*.3),this.setBoundingBox(),r===undefined?i.call(this,e,t,n):i.call(this,e,t,n,r)};var s=e.moveTo;e.moveTo=function(e,t){return this.updateMinMax(e,t),s.call(this,e,t)};var o=e.lineTo;e.lineTo=function(e,t){return this.updateMinMax(e,t),o.call(this,e,t)};var u=e.quadraticCurveTo;e.quadraticCurveTo=function(e,t,n,r){return this.updateMinMax(n,r),this.updateMinMax(e,t),u.call(this,e,t,n,r)};var a=e.bezierCurveTo;e.bezierCurveTo=function(e,t,n,r,i,s){return this.updateMinMax(i,s),this.updateMinMax(e,t),this.updateMinMax(n,r),a.call(this,e,t,n,r,i,s)};var f=e.rect;e.rect=function(e,t,n,r){return this.updateMinMax(e,t),this.updateMinMax(e,t+r),this.updateMinMax(e+n,t),this.updateMinMax(e+n,t+r),f.call(this,e,t,n,r)};var l=e.fill;e.fill=function(){return this.setBoundingBox(),l.call(this)};var c=e.drawImage;e.drawImage=function(){return this.pathBBox={},this.pathBBox.minX=this.pathBBox.minY=-99999999999,this.pathBBox.maxX=this.pathBBox.maxY=99999999999,this.setBoundingBox(),c.apply(this,arguments)};var h=e.stroke;e.stroke=function(){return this.setBoundingBox(this.lineWidth/2+3),h.call(this)},e.setBoundingBox=function(e){var t=(e||0)*this.transfomMatrix[0],n=(e||0)*this.transfomMatrix[3],r=Math.min(Math.max(0,this.pathBBox.minX-t),this.canvas.width),i=Math.min(Math.max(0,this.pathBBox.minY-n),this.canvas.height),s=Math.min(Math.max(0,this.pathBBox.maxX+t),this.canvas.width),o=Math.min(Math.max(0,this.pathBBox.maxY+n),this.canvas.height);this.boundingBox={x:r,y:i,w:s-r,h:o-i}},e.popBoundingBox=function(){var e=this.boundingBox;return this.boundingBox=null,e!=null&&(e.x=Math.floor(e.x),e.y=Math.floor(e.y),e.w=Math.ceil(e.w),e.h=Math.ceil(e.h)),e}}}function A(e,t,n,i){if(i==null||i.w==0||i.h==0)return;var s=(new Date).getTime(),o=e.getImageData(i.x,i.y,i.w,i.h),u=t.getImageData(i.x,i.y,i.w,i.h);for(var a=0;a<o.data.length/4;a++)u.data[4*a+3]>0&&(o.data[4*a]=u.data[4*a]^n.r^o.data[4*a],o.data[4*a+1]=u.data[4*a+1]^n.g^o.data[4*a+1],o.data[4*a+2]=u.data[4*a+2]^n.b^o.data[4*a+2],o.data[4*a+3]=o.data[4*a+3]);e.putImageData(o,i.x,i.y),r.logDebug&&console.log("DirectDraw DEBUG xormode - composition pixelsize:"+i.w*i.h+" duration(ms): "+((new Date).getTime()-s))}function O(e,t){delete t.graphicsStates[e]}function M(e,t,n){var r=n.graphicsStates;r[t]!=null?_(r[t],e):console.log("Graphics with id "+t+" not initialized!"),n.currentStateId=t}function _(e,t){if(e!=null){e.strokeArgs!=null&&W(t,e.strokeArgs),e.paintArgs!=null&&X(t,e.paintArgs),e.compositeArgs!=null&&G(t,e.compositeArgs),e.fontArgs!=null&&q(t,e.fontArgs);if(e.transform!=null){var n=e.transform;t.setTransform(n[0],n[1],n[2],n[3],n[4],n[5])}else{var r=bt();t.setTransform(r[0],r[1],r[2],r[3],r[4],r[5])}}}function D(e,t,n,r){var i=r.graphicsStates;i[t]==null?(i[t]={},r.currentStateId=t,n.shift(),i[t].transform=z(e,n),n.shift(),W(e,n),i[t].strokeArgs=n.slice(0,1),n.shift(),G(e,n),i[t].compositeArgs=n.slice(0,1),n.shift(),X(e,n),i[t].paintArgs=n.slice(0,1),n.shift(),i[t].fontArgs=n,i[t].fontTransform=q(e,n)):console.log("Graphics with id "+t+" already exist!")}function P(e,t,n){e.save(),Y(e,t[1])&&e.clip(vt(t[1])),Y(e,t[0],!0,n),e.stroke(),e.restore()}function H(e,t){e.save(),Y(e,t[1])&&e.clip(vt(t[1])),Y(e,t[0]),e.fill(vt(t[0])),e.restore()}function B(e,t){e.save();var n=t[0].image.data,r=t[1],i=t[2],s=t[3],o=t[4];Y(e,o)&&e.clip(vt(o)),r!=null&&U(e,[r]),s!=null&&(e.fillStyle=ot(s.color.rgba),e.beginPath(),i==null?e.rect(0,0,n.width,n.height):e.rect(0,0,i.rectangle.w,i.rectangle.h),e.fill()),i==null?e.drawImage(n,0,0):(i=i.rectangle,e.drawImage(n,i.x,i.y,i.w,i.h,0,0,i.w,i.h)),e.restore()}function j(e,t,n){var i=t[0],s=t[1],o=t[2],u=t[3],a=g.pop();return w(n,a).then(function(t){e.save();var n=r.dpr;Y(e,u)&&e.clip(vt(u)),i!=null&&U(e,[i]),o!=null&&(e.fillStyle=ot(o.color.rgba),e.beginPath(),s==null?e.rect(0,0,t.width/n,t.height/n):e.rect(0,0,s.rectangle.w,s.rectangle.h),e.fill()),s==null?e.drawImage(t,0,0,t.width,t.height,0,0,t.width/n,t.height/n):(s=s.rectangle,e.drawImage(t,s.x*n,s.y*n,s.w*n,s.h*n,0,0,s.w,s.h)),e.restore(),t.width=0,g.push(t)})}function F(e,t){var n=mt(t[0].combined.ids,v),r=n[0].points,i=n[1].points,s=n.slice(2),o=t[1];e.save(),Y(e,o)&&e.clip(vt(o));if(s.length>0){var u=document.createElement("canvas");u.width=r.points[2],u.height=r.points[3];var a=u.getContext("2d");for(var f=0;f<s.length;f++)if(s[f].glyph.data!=null){var l=s[f].glyph.data,c=i.points[f*2],h=i.points[f*2+1];a.drawImage(l,0,0,l.width,l.height,c,h,l.width,l.height)}a.fillStyle=e.fillStyle,a.globalCompositeOperation="source-in",a.fillRect(0,0,u.width,u.height),e.drawImage(u,0,0,u.width,u.height,r.points[0],r.points[1],u.width,u.height)}e.restore()}function I(e,t,n){var r=t[0].string,i=t[1].points.points,s=i[0],o=i[1],u=t[2];e.save(),Y(e,u)&&e.clip(vt(u));if(n!=null){var a=n;e.transform(a.m00,a.m10,a.m01,a.m11,a.m02+s,a.m12+o),e.fillText(r,0,0)}else{var f=s;for(var l=0;l<r.length;l++){var c=r.charAt(l),h=e.measureText(c).width;e.save();var p=i[l+2]/h;e.scale(p,1),e.fillText(c,f/p,o),e.restore(),f+=i[l+2]}}e.restore()}function q(e,t){if(t[0]==null)return e.font;var n=t[0].font,r="";switch(n.style){case p.NORMAL:r="";break;case p.OBLIQUE:r="bold";break;case p.ITALIC:r="italic";break;case p.BOLDANDITALIC:r="bold italic"}var s=n.family;return n.family!=="sans-serif"&&n.family!=="serif"&&n.family!=="monospace"&&(s='"'+i+n.family+'"'),e.font=r+" "+n.size+"px "+s,n.transform}function R(e,t){var n=t[0].points.points,i=t[1],s=r.dpr;e.save(),Y(e,i)&&e.clip(vt(i)),e.beginPath(),e.setTransform(1,0,0,1,0,0),e.rect(n[0]*s,n[1]*s,n[2]*s,n[3]*s),e.clip(),e.translate(n[4]*s,n[5]*s),e.drawImage(e.canvas,0,0),e.restore()}function U(e,t){var n=t[0].transform;return e.transform(n.m00,n.m10,n.m01,n.m11,n.m02,n.m12),[n.m00,n.m10,n.m01,n.m11,n.m02,n.m12]}function z(e,t){var n=t[0].transform;return n=yt([n.m00,n.m10,n.m01,n.m11,n.m02,n.m12]),e.setTransform(n[0],n[1],n[2],n[3],n[4],n[5]),n}function W(e,t){var n=t[0].stroke;e.lineWidth=n.width,e.miterLimit=n.miterLimit;switch(n.cap){case h.CAP_BUTT:e.lineCap="butt";break;case h.CAP_ROUND:e.lineCap="round";break;case h.CAP_SQUARE:e.lineCap="square"}switch(n.join){case c.JOIN_MITER:e.lineJoin="miter";break;case c.JOIN_ROUND:e.lineJoin="round";break;case c.JOIN_BEVEL:e.lineJoin="bevel"}n.dash!=null&&e.setLineDash!=null&&(e.setLineDash(n.dash),e.lineDashOffset=n.dashOffset)}function X(e,t){var n=t[0];if(n.color!=null){var r=ot(n.color.rgba);e.fillStyle=r,e.strokeStyle=r}else if(n.texture!=null){var i=n.texture.anchor,s=n.texture.image.data,o;if(i.x==0&&i.y==0&&i.w==s.width&&i==s.height)o=e.createPattern(s,"repeat");else{var u=document.createElement("canvas"),a=i.x<0?i.x%i.w+i.w:i.x%i.w,f=i.y<0?i.y%i.h+i.h:i.y%i.h;u.width=i.w,u.height=i.h;var l=u.getContext("2d");l.fillRect(0,0,i.w,i.h),l.fillStyle=l.createPattern(s,"repeat"),l.setTransform(i.w/s.width,0,0,i.h/s.height,a,f),l.fillRect(-a*s.width/i.w,-f*s.height/i.h,s.width,s.height),o=e.createPattern(u,"repeat")}e.fillStyle=o,e.strokeStyle=o}else if(n.linearGrad!=null){var c=V(e,n.linearGrad);e.fillStyle=c,e.strokeStyle=c}else if(n.radialGrad!=null){var c=J(e,n.radialGrad);e.fillStyle=c,e.strokeStyle=c}}function V(e,t){var n=t.xStart,r=t.yStart,i=t.xEnd-n,s=t.yEnd-r,o=1,u=o,a=0;if(t.repeat!=l.NO_CYCLE&&(i!=0||s!=0)){var f=e.canvas,c=[$(n,r,i,s,0,0),$(n,r,i,s,f.width,0),$(n,r,i,s,f.width,f.height),$(n,r,i,s,0,f.height)];u=Math.ceil(Math.max.apply(Math,c)),a=Math.ceil(-Math.min.apply(Math,c)),o=u+a}var h=e.createLinearGradient(n-i*a,r-s*a,n+i*u,r+s*u);for(var p=-a,d=0;p<u;p++,d++)if(t.repeat!=l.REFLECT||p%2==0)for(var v=0;v<t.colors.length;v++)h.addColorStop((d+t.fractions[v])/o,ot(t.colors[v]));else for(var v=t.colors.length-1;v>=0;v--)h.addColorStop((d+(1-t.fractions[v]))/o,ot(t.colors[v]));return h}function $(e,t,n,r,i,s){return((i-e)*n+(s-t)*r)/(n*n+r*r)}function J(e,t){K(t);var n=t.xFocus,r=t.yFocus,i=t.xCenter-n,s=t.yCenter-r,o=t.radius,u=1;if(t.repeat!=l.NO_CYCLE)if(i==0&&s==0){var a=e.canvas,f=[Q(n,r,0,0)/o,Q(n,r,a.width,0)/o,Q(n,r,a.width,a.height)/o,Q(n,r,0,a.height)/o];u=Math.ceil(Math.max.apply(Math,f))}else{var c=Math.sqrt(i*i+s*s),h=i+o*i/c,p=s+o*s/c,d=i-o*i/c,v=s-o*s/c,a=e.canvas,f=[$(n,r,h,p,0,0),$(n,r,h,p,a.width,0),$(n,r,h,p,a.width,a.height),$(n,r,h,p,0,a.height),$(n,r,d,v,0,0),$(n,r,d,v,a.width,0),$(n,r,d,v,a.width,a.height),$(n,r,d,v,0,a.height)];u=Math.ceil(Math.max.apply(Math,f))}var m=e.createRadialGradient(n,r,0,n+u*i,r+u*s,o*u);for(var g=0;g<u;g++)if(t.repeat!=l.REFLECT||g%2==0)for(var y=0;y<t.colors.length;y++)m.addColorStop((g+t.fractions[y])/u,ot(t.colors[y]));else for(var y=t.colors.length-1;y>=0;y--)m.addColorStop((g+(1-t.fractions[y]))/u,ot(t.colors[y]));return m}function K(e){var t=e.xFocus-e.xCenter,n=e.yFocus-e.yCenter;if(t==0&&n==0)return;var r=.99,i=e.radius*e.radius,s=t*t+n*n;if(s>i*r){var o=Math.sqrt(i*r/s);e.xFocus=e.xCenter+t*o,e.yFocus=e.yCenter+n*o}}function Q(e,t,n,r){return Math.sqrt((n-e)*(n-e)+(r-t)*(r-t))}function G(e,t){var n=t[0].composite;if(n!=null){e.globalAlpha=n.alpha;switch(n.type){case d.CLEAR:e.globalCompositeOperation="destination-out",e.globalAlpha=1;break;case d.SRC:e.globalCompositeOperation="source-over";break;case d.DST:e.globalCompositeOperation="destination-over",e.globalAlpha=0;break;case d.SRC_OVER:e.globalCompositeOperation="source-over";break;case d.DST_OVER:e.globalCompositeOperation="destination-over";break;case d.SRC_IN:e.globalCompositeOperation="source-in";break;case d.DST_IN:e.globalCompositeOperation="destination-in";break;case d.SRC_OUT:e.globalCompositeOperation="source-out";break;case d.DST_OUT:e.globalCompositeOperation="destination-out";break;case d.SRC_ATOP:e.globalCompositeOperation="source-atop";break;case d.DST_ATOP:e.globalCompositeOperation="destination-atop";break;case d.XOR:e.globalCompositeOperation="xor";break;case d.XOR_MODE:e.globalCompositeOperation="source-over"}}}function Y(e,t,n,r){if(t==null)return!1;var i=st(e,n,r);if(t.rectangle!=null)return e.beginPath(),Z(e,t.rectangle,i),!0;if(t.roundRectangle!=null)return e.beginPath(),nt(e,t.roundRectangle,i),!0;if(t.ellipse!=null)return e.beginPath(),et(e,t.ellipse,i),!0;if(t.arc!=null)return e.beginPath(),it(e,t.arc,i),!0;if(t.path!=null){e.beginPath();var s=t.path,o=0;return s.type.forEach(function(t,n){switch(t){case a.MOVE:e.moveTo(s.points[o+0]+i.x,s.points[o+1]+i.y),o+=2;break;case a.LINE:e.lineTo(s.points[o+0]+i.x,s.points[o+1]+i.y),o+=2;break;case a.QUAD:e.quadraticCurveTo(s.points[o+0]+i.x,s.points[o+1]+i.y,s.points[o+2]+i.x,s.points[o+3]+i.y),o+=4;break;case a.CUBIC:e.bezierCurveTo(s.points[o+0]+i.x,s.points[o+1]+i.y,s.points[o+2]+i.x,s.points[o+3]+i.y,s.points[o+4]+i.x,s.points[o+5]+i.y),o+=6;break;case a.CLOSE:e.closePath();break;default:console.log("segment.type:"+segment.type+" not recognized")}}),!0}return!1}function Z(e,t,n){e.rect(t.x+n.x,t.y+n.y,t.w,t.h)}function et(e,t,n){var r=.5522847498307933,i=.5+r*.5,s=.5-r*.5;e.moveTo(t.x+n.x+t.w,t.y+n.y+.5*t.h);var o=tt([1,i,i,1,.5,1],t,n);e.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5]),o=tt([s,1,0,i,0,.5],t,n),e.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5]),o=tt([0,s,s,0,.5,0],t,n),e.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5]),o=tt([i,0,1,s,1,.5],t,n),e.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5]),e.closePath()}function tt(e,t,n){return e[0]=t.x+n.x+e[0]*t.w,e[1]=t.y+n.y+e[1]*t.h,e[2]=t.x+n.x+e[2]*t.w,e[3]=t.y+n.y+e[3]*t.h,e[4]=t.x+n.x+e[4]*t.w,e[5]=t.y+n.y+e[5]*t.h,e}function nt(e,t,n){var r=.22385762508460333,i=rt([0,0,0,.5],t,n);e.moveTo(i[0],i[1]),i=rt([0,0,1,-0.5],t,n),e.lineTo(i[0],i[1]),i=rt([0,0,1,-r,0,r,1,0,0,.5,1,0],t,n),e.bezierCurveTo(i[0],i[1],i[2],i[3],i[4],i[5]),i=rt([1,-0.5,1,0],t,n),e.lineTo(i[0],i[1]),i=rt([1,-r,1,0,1,0,1,-r,1,0,1,-0.5],t,n),e.bezierCurveTo(i[0],i[1],i[2],i[3],i[4],i[5]),i=rt([1,0,0,.5],t,n),e.lineTo(i[0],i[1]),i=rt([1,0,0,r,1,-r,0,0,1,-0.5,0,0],t,n),e.bezierCurveTo(i[0],i[1],i[2],i[3],i[4],i[5]),i=rt([0,.5,0,0],t,n),e.lineTo(i[0],i[1]),i=rt([0,r,0,0,0,0,0,r,0,0,0,.5],t,n),e.bezierCurveTo(i[0],i[1],i[2],i[3],i[4],i[5]),e.closePath()}function rt(e,t,n){var r=[],i=0;for(var s=0;s<e.length;s+=4)r[i++]=t.x+n.x+e[s+0]*t.w+e[s+1]*Math.abs(t.arcW),r[i++]=t.y+n.y+e[s+2]*t.h+e[s+3]*Math.abs(t.arcH);return r}function it(e,t,n){var r=t.w/2,i=t.h/2,s=t.x+n.x+r,o=t.y+n.y+i,u=-(t.start*Math.PI/180),a=-t.extent,l=4,c=a<0?Math.PI/2:-Math.PI/2,h=a<0?.5522847498307933:-0.5522847498307933;a>-360&&a<360&&(l=Math.ceil(Math.abs(a)/90),c=a/l*Math.PI/180,h=4/3*Math.sin(c/2)/(1+Math.cos(c/2)),l=h==0?0:l),e.moveTo(s+Math.cos(u)*r,o+Math.sin(u)*i);for(var p=0;p<l;p++){var d=u+c*p,v=Math.cos(d),m=Math.sin(d),g=[];g[0]=s+(v-h*m)*r,g[1]=o+(m+h*v)*i,d+=c,v=Math.cos(d),m=Math.sin(d),g[2]=s+(v+h*m)*r,g[3]=o+(m-h*v)*i,g[4]=s+v*r,g[5]=o+m*i,e.bezierCurveTo(g[0],g[1],g[2],g[3],g[4],g[5])}switch(t.type){case f.OPEN:break;case f.CHORD:e.closePath();break;case f.PIE:e.lineTo(s,o),e.closePath()}}function st(e,t,n){if(!t)return{x:0,y:0};var i=e.lineWidth*n[0]/r.dpr%2,s=e.lineWidth*n[3]/r.dpr%2,o=i>1e-4&&i<1.9999?.5/n[0]*r.dpr:0,u=s>1e-4&&s<1.9999?.5/n[3]*r.dpr:0;return{x:o,y:u}}function ot(e){var t=ut(e);return"rgba("+t.r+","+t.g+","+t.b+","+t.a/255+")"}function ut(e){var t=255;return{r:e>>>24&t,g:e>>>16&t,b:e>>>8&t,a:e&t}}function at(e){return new Promise(function(t,n){try{ht(e,t,n)}catch(i){r.onErrorMessage(error),n(i)}})}function ft(e){return new Promise(function(t,n){try{if(e.length>0){var s=e.map(function(e){return new Promise(function(t){if(m.indexOf(e.name)>=0)t();else{m.push(e.name);var n=document.createElement("style");n.type="text/css",n.setAttribute("data-dd-ctx",i);var r=i+e.name;n.innerHTML=ct(r,e.font,e.style),document.body.appendChild(n),lt(r)?t():setTimeout(t,5)}})});Promise.all(s).then(t)}else t()}catch(o){r.onErrorMessage(error),n(o)}})}function lt(e){var t=document.createElement("canvas"),n=t.getContext("2d"),r="abcdefghijklmnopqrstuvwxyz0123456789";n.font="72px monospace";var i=n.measureText(r).width;n.font="72px '"+e+"', monospace";var s=n.measureText(r).width;return s==i?!1:!0}function ct(e,t,n){var r="@font-face {";return r+="font-family: '"+e+"';",r+="src: url(data:font/truetype;base64,"+pt(t)+");",n!=null&&(r+="font-style: "+n+";"),r+="}",r}function ht(e,t,n){if(e.length>0){var r=e.map(function(e){return new Promise(function(t){var n=new Image;n.onload=function(){e.data=n,t()},n.src=dt(e)})});Promise.all(r).then(t)}else t()}function pt(e){var t="",n=new Uint8Array(e.buffer,e.offset,e.limit-e.offset);for(var r=0,i=n.byteLength;r<i;r++)t+=String.fromCharCode(n[r]);return window.btoa(t)}function dt(e){return"data:image/png;base64,"+pt(e.data)}function vt(e){return e.path!=null?e.path.windingOdd?"evenodd":"nonzero":"nonzero"}function mt(e,t){var n=[];for(var r=0;r<e.length;r++)n[r]=v[e[r]];return n}function gt(e,t){var n=[];return e==null&&(e=bt()),n[0]=e[0]*t[0]+e[2]*t[1],n[1]=e[1]*t[0]+e[3]*t[1],n[2]=e[0]*t[2]+e[2]*t[3],n[3]=e[1]*t[2]+e[3]*t[3],n[4]=e[0]*t[4]+e[2]*t[5]+e[4],n[5]=e[1]*t[4]+e[3]*t[5]+e[5],n}function yt(e){return gt(bt(),e)}function bt(){return[r.dpr,0,0,r.dpr,0,0]}function wt(e,t,n){var r=n[0]*e+n[2]*t+n[4],i=n[1]*e+n[3]*t+n[5];return{x:r,y:i}}function Et(){var e=document.body.getElementsByTagName("style"),t=[];for(var n=0;n<e.length;n++)e[n].getAttribute("data-dd-ctx")===i&&t.push(e[n]);t.forEach(function(e){document.body.removeChild(e)})}function St(e,t){if(r.logDebug&&t!=null){var n=(new Date).getTime()-e,i=t.instructions==null?0:t.instructions.length,s=t.constants==null?0:t.constants.length,o=t.fontFaces==null?0:t.fontFaces.length;console.log("DirectDraw DEBUG render time "+n+"ms (insts:"+i+", consts:"+s+", fonts:"+o+")")}}function xt(e){function t(t,r){return function(){console.log("ctx."+r+"("+n(arguments)+")"),t.apply(e,arguments)}}function n(e){var t="";for(var n=0;n<e.length;n++)t+=","+JSON.stringify(e[n]);return t.length>0?t.substring(1):t}return e.traceLoggerWrapped?e:(["fill","stroke","beginPath","save","restore","setTransform","clip","rect","drawImage","fillRect","transform","fillText","scale","setLineDash","moveTo","lineTo","quadraticCurveTo","bezierCurveTo","closePath"].reduce(function(e,n){return e[n]=t(e[n],n),e},e),e.traceLoggerWrapped=!0,e)}n=n||{};var r={logDebug:n.logDebug||!1,logTrace:n.logTrace||!1,ieVersion:n.ieVersion||!1,onErrorMessage:n.onErrorMessage||function(e){console.log(e.stack)},dpr:n.dpr||1},i=Math.floor(Math.random()*65536).toString(16),s=t!=null?e.loadProto(t,"directdraw.proto"):e.loadProtoFile("/directdraw.proto"),o=s.build("org.webswing.directdraw.proto.WebImageProto"),u=s.build("org.webswing.directdraw.proto.DrawInstructionProto.InstructionProto"),a=s.build("org.webswing.directdraw.proto.PathProto.SegmentTypeProto"),f=s.build("org.webswing.directdraw.proto.ArcProto.ArcTypeProto"),l=s.build("org.webswing.directdraw.proto.CyclicMethodProto"),c=s.build("org.webswing.directdraw.proto.StrokeProto.StrokeJoinProto"),h=s.build("org.webswing.directdraw.proto.StrokeProto.StrokeCapProto"),p=s.build("org.webswing.directdraw.proto.FontProto.StyleProto"),d=s.build("org.webswing.directdraw.proto.CompositeProto.CompositeTypeProto"),v=n.constantPoolCache||{},m=[],g=[],y;return{draw64:b,drawBin:w,drawProto:E,dispose:Et,getConstantPoolCache:function(){return v}}}});